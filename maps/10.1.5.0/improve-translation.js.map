{"version":3,"file":"../../popup/improve-translation.js","names":["$","document","querySelector","bind","addEventListener","window","history","back","twpConfig","setTargetLanguage","value","chrome","tabs","query","active","currentWindow","sendMessage","id","action","sourceLanguage","pageTranslatorService","dontSortResults","targetLanguage","response","checkedLastError","onReady","then","twpI18n","updateUiMessages","translateDocument","get","pageService","langs","twpLang","getLanguageList","langsSorted","i","push","sort","a","b","localeCompare","eAllLangs","selectTargetLanguage","forEach","option","createElement","textContent","appendChild","selectOriginalLanguage_group_1","frameId","tabLanguage","fixTLanguageCode","selectOriginalLanguage_group_2","eRecentsLangs","disableDarkMode","el","setAttribute","head","enableDarkMode","remove","matchMedia","matches"],"sources":["improve-translation.js"],"sourcesContent":["\"use strict\";\r\n\r\nlet $ = document.querySelector.bind(document);\r\n\r\n$(\"#btnClose\").addEventListener(\"click\", () => {\r\n  window.history.back();\r\n});\r\n\r\n$(\"#btnApply\").addEventListener(\"click\", () => {\r\n  twpConfig.setTargetLanguage($(\"#selectTargetLanguage\").value, true);\r\n  // twpConfig.set(\"dontSortResults\", $(\"#dontSortResults\").value);\r\n\r\n  chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {\r\n    chrome.tabs.sendMessage(\r\n      tabs[0].id,\r\n      {\r\n        action: \"improveTranslation\",\r\n        sourceLanguage: $(\"#selectOriginalLanguage\").value,\r\n        pageTranslatorService: $(\"#pageTranslatorService\").value,\r\n        dontSortResults: $(\"#dontSortResults\").value,\r\n        targetLanguage: $(\"#selectTargetLanguage\").value,\r\n      },\r\n      (response) => {\r\n        checkedLastError();\r\n        window.history.back();\r\n      }\r\n    );\r\n  });\r\n});\r\n\r\ntwpConfig\r\n  .onReady()\r\n  .then(() => twpI18n.updateUiMessages())\r\n  .then(() => {\r\n    twpI18n.translateDocument();\r\n\r\n    $(\"#pageTranslatorService\").value = twpConfig.get(\"pageTranslatorService\");\r\n    $(\"#dontSortResults\").value = twpConfig.get(\"dontSortResults\");\r\n    chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {\r\n      chrome.tabs.sendMessage(\r\n        tabs[0].id,\r\n        { action: \"getCurrentSourceLanguage\" },\r\n        (sourceLanguage) => {\r\n          checkedLastError();\r\n          $(\"#selectOriginalLanguage\").value = sourceLanguage\r\n            ? sourceLanguage\r\n            : \"auto\";\r\n        }\r\n      );\r\n\r\n      chrome.tabs.sendMessage(\r\n        tabs[0].id,\r\n        { action: \"getCurrentPageTranslatorService\" },\r\n        (pageService) => {\r\n          checkedLastError();\r\n          if (pageService) {\r\n            $(\"#pageTranslatorService\").value = pageService;\r\n          }\r\n        }\r\n      );\r\n      chrome.tabs.sendMessage(\r\n        tabs[0].id,\r\n        { action: \"getDontSortResults\" },\r\n        (dontSortResults) => {\r\n          checkedLastError();\r\n          $(\"#dontSortResults\").value = dontSortResults ? \"yes\" : \"no\";\r\n        }\r\n      );\r\n    });\r\n\r\n    let langs = twpLang.getLanguageList();\r\n\r\n    const langsSorted = [];\r\n\r\n    for (const i in langs) {\r\n      langsSorted.push([i, langs[i]]);\r\n    }\r\n\r\n    langsSorted.sort(function (a, b) {\r\n      return a[1].localeCompare(b[1]);\r\n    });\r\n\r\n    const eAllLangs = selectTargetLanguage.querySelector('[name=\"all\"]');\r\n    langsSorted.forEach((value) => {\r\n      const option = document.createElement(\"option\");\r\n      option.value = value[0];\r\n      option.textContent = value[1];\r\n      eAllLangs.appendChild(option);\r\n    });\r\n\r\n    const selectOriginalLanguage_group_1 = $(\"#selectOriginalLanguage > [name='group_1']\");\r\n    chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {\r\n      chrome.tabs.sendMessage(\r\n        tabs[0].id,\r\n        {\r\n          action: \"getOriginalTabLanguage\",\r\n        },\r\n        {\r\n          frameId: 0,\r\n        },\r\n        (tabLanguage) => {\r\n          checkedLastError();\r\n          if (\r\n            tabLanguage && (tabLanguage = twpLang.fixTLanguageCode(tabLanguage))\r\n          ) {\r\n            langsSorted.forEach((value) => {\r\n              if (value[0] === tabLanguage) {\r\n                const option = document.createElement(\"option\");\r\n                option.value = value[0];\r\n                option.textContent = value[1];\r\n                selectOriginalLanguage_group_1.appendChild(option);\r\n              }\r\n            });\r\n          }\r\n        }\r\n      );\r\n    });\r\n  \r\n    const selectOriginalLanguage_group_2 = $(\"#selectOriginalLanguage > [name='group_2']\");\r\n    langsSorted.forEach((value) => {\r\n      const option = document.createElement(\"option\");\r\n      option.value = value[0];\r\n      option.textContent = value[1];\r\n      selectOriginalLanguage_group_2.appendChild(option);\r\n    });\r\n\r\n    const eRecentsLangs =\r\n      selectTargetLanguage.querySelector('[name=\"targets\"]');\r\n    for (const value of twpConfig.get(\"targetLanguages\")) {\r\n      const option = document.createElement(\"option\");\r\n      option.value = value;\r\n      option.textContent = langs[value];\r\n      eRecentsLangs.appendChild(option);\r\n    }\r\n    selectTargetLanguage.value = twpConfig.get(\"targetLanguages\")[0];\r\n\r\n    function disableDarkMode() {\r\n      if (!$(\"#lightModeElement\")) {\r\n        const el = document.createElement(\"style\");\r\n        el.setAttribute(\"id\", \"lightModeElement\");\r\n        el.setAttribute(\"rel\", \"stylesheet\");\r\n        el.textContent = `\r\n            body {\r\n                color: rgb(0, 0, 0);\r\n                background-color: rgb(224, 224, 224);\r\n            }\r\n  \r\n            .select, #btnApply {\r\n                color: black;\r\n                background-color: rgba(0, 0, 0, 0.2);\r\n            }\r\n            \r\n            .select:hover, .select:focus, #btnApply:hover {\r\n                background-color: rgba(0, 0, 0, 0.4);\r\n            }\r\n  \r\n            .mdiv, .md {\r\n                background-color: rgb(0, 0, 0);\r\n            }\r\n            `;\r\n        document.head.appendChild(el);\r\n      }\r\n    }\r\n\r\n    function enableDarkMode() {\r\n      if ($(\"#lightModeElement\")) {\r\n        $(\"#lightModeElement\").remove();\r\n      }\r\n    }\r\n\r\n    switch (twpConfig.get(\"darkMode\")) {\r\n      case \"auto\":\r\n        if (matchMedia(\"(prefers-color-scheme: dark)\").matches) {\r\n          enableDarkMode();\r\n        } else {\r\n          disableDarkMode();\r\n        }\r\n        break;\r\n      case \"yes\":\r\n        enableDarkMode();\r\n        break;\r\n      case \"no\":\r\n        disableDarkMode();\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  });\r\n"],"mappings":"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","ignoreList":[]}