{"version":3,"file":"../../lib/XMLHttpRequestShim.js","names":["sHeaders","Symbol","sRespHeaders","sAbortController","sMethod","sURL","sMIME","sDispatch","sErrored","sTimeout","sTimedOut","sIsResponseText","XMLHttpRequestShim","XMLHttpRequest","EventTarget","constructor","readyState","UNSENT","response","responseType","responseURL","status","statusText","timeout","withCredentials","Object","create","accept","AbortController","OPENED","HEADERS_RECEIVED","LOADING","DONE","responseText","DOMException","responseXML","Error","evt","attr","type","addEventListener","bind","once","dispatchEvent","abort","open","method","url","setRequestHeader","header","value","String","toLowerCase","overrideMimeType","mimeType","getAllResponseHeaders","entries","map","join","getResponseHeader","headerName","send","body","setTimeout","fetch","signal","headers","credentials","finally","clearTimeout","CustomEvent","then","resp","finalMIME","assign","text","Blob","arrayBuffer","json","err","eventName","name"],"sources":["XMLHttpRequestShim.js"],"sourcesContent":["/* global module */\r\n/* global EventTarget, AbortController, DOMException */\r\n\r\nconst sHeaders = Symbol(\"headers\");\r\nconst sRespHeaders = Symbol(\"response headers\");\r\nconst sAbortController = Symbol(\"AbortController\");\r\nconst sMethod = Symbol(\"method\");\r\nconst sURL = Symbol(\"URL\");\r\nconst sMIME = Symbol(\"MIME\");\r\nconst sDispatch = Symbol(\"dispatch\");\r\nconst sErrored = Symbol(\"errored\");\r\nconst sTimeout = Symbol(\"timeout\");\r\nconst sTimedOut = Symbol(\"timedOut\");\r\nconst sIsResponseText = Symbol(\"isResponseText\");\r\n\r\nconst XMLHttpRequestShim = class XMLHttpRequest extends EventTarget {\r\n  constructor() {\r\n    super();\r\n    this.readyState = this.constructor.UNSENT;\r\n    this.response = null;\r\n    this.responseType = \"\";\r\n    this.responseURL = \"\";\r\n    this.status = 0;\r\n    this.statusText = \"\";\r\n    this.timeout = 0;\r\n    this.withCredentials = false;\r\n    this[sHeaders] = Object.create(null);\r\n    this[sHeaders].accept = \"*/*\";\r\n    this[sRespHeaders] = Object.create(null);\r\n    this[sAbortController] = new AbortController();\r\n    this[sMethod] = \"\";\r\n    this[sURL] = \"\";\r\n    this[sMIME] = \"\";\r\n    this[sErrored] = false;\r\n    this[sTimeout] = 0;\r\n    this[sTimedOut] = false;\r\n    this[sIsResponseText] = true;\r\n  }\r\n  static get UNSENT() {\r\n    return 0;\r\n  }\r\n  static get OPENED() {\r\n    return 1;\r\n  }\r\n  static get HEADERS_RECEIVED() {\r\n    return 2;\r\n  }\r\n  static get LOADING() {\r\n    return 3;\r\n  }\r\n  static get DONE() {\r\n    return 4;\r\n  }\r\n  get responseText() {\r\n    if (this[sErrored]) return null;\r\n    if (this.readyState < this.constructor.HEADERS_RECEIVED) return \"\";\r\n    if (this[sIsResponseText]) return this.response;\r\n    throw new DOMException(\"Response type not set to text\", \"InvalidStateError\");\r\n  }\r\n  get responseXML() {\r\n    throw new Error(\"XML not supported\");\r\n  }\r\n  [sDispatch](evt) {\r\n    const attr = `on${evt.type}`;\r\n    if (typeof this[attr] === \"function\") {\r\n      this.addEventListener(evt.type, this[attr].bind(this), {\r\n        once: true\r\n      });\r\n    }\r\n    this.dispatchEvent(evt);\r\n  }\r\n  abort() {\r\n    this[sAbortController].abort();\r\n    this.status = 0;\r\n    this.readyState = this.constructor.UNSENT;\r\n  }\r\n  open(method, url) {\r\n    this.status = 0;\r\n    this[sMethod] = method;\r\n    this[sURL] = url;\r\n    this.readyState = this.constructor.OPENED;\r\n  }\r\n  setRequestHeader(header, value) {\r\n    header = String(header).toLowerCase();\r\n    if (typeof this[sHeaders][header] === \"undefined\") {\r\n      this[sHeaders][header] = String(value);\r\n    } else {\r\n      this[sHeaders][header] += `, ${value}`;\r\n    }\r\n  }\r\n  overrideMimeType(mimeType) {\r\n    this[sMIME] = String(mimeType);\r\n  }\r\n  getAllResponseHeaders() {\r\n    if (this[sErrored] || this.readyState < this.constructor.HEADERS_RECEIVED) return \"\";\r\n    return Object.entries(this[sRespHeaders]).map(([header, value]) => `${header}: ${value}`).join(\"\\r\\n\");\r\n  }\r\n  getResponseHeader(headerName) {\r\n    const value = this[sRespHeaders][String(headerName).toLowerCase()];\r\n    return typeof value === \"string\" ? value : null;\r\n  }\r\n  send(body = null) {\r\n    if (this.timeout > 0) {\r\n      this[sTimeout] = setTimeout(() => {\r\n        this[sTimedOut] = true;\r\n        this[sAbortController].abort();\r\n      }, this.timeout);\r\n    }\r\n    const responseType = this.responseType || \"text\";\r\n    this[sIsResponseText] = responseType === \"text\";\r\n    fetch(this[sURL], {\r\n      method: this[sMethod] || \"GET\",\r\n      signal: this[sAbortController].signal,\r\n      headers: this[sHeaders],\r\n      credentials: this.withCredentials ? \"include\" : \"same-origin\",\r\n      body\r\n    }).finally(() => {\r\n      this.readyState = this.constructor.DONE;\r\n      clearTimeout(this[sTimeout]);\r\n      this[sDispatch](new CustomEvent(\"loadstart\"));\r\n    }).then(async resp => {\r\n      this.responseURL = resp.url;\r\n      this.status = resp.status;\r\n      this.statusText = resp.statusText;\r\n      const finalMIME = this[sMIME] || this[sRespHeaders][\"content-type\"] || \"text/plain\";\r\n      Object.assign(this[sRespHeaders], resp.headers);\r\n      switch (responseType) {\r\n        case \"text\":\r\n          this.response = await resp.text();\r\n          break;\r\n        case \"blob\":\r\n          this.response = new Blob([await resp.arrayBuffer()], { type: finalMIME });\r\n          break;\r\n        case \"arraybuffer\":\r\n          this.response = await resp.arrayBuffer();\r\n          break;\r\n        case \"json\":\r\n          this.response = await resp.json();\r\n          break;\r\n      }\r\n      this[sDispatch](new CustomEvent(\"load\"));\r\n    }, err => {\r\n      let eventName = \"abort\";\r\n      if (err.name !== \"AbortError\") {\r\n        this[sErrored] = true;\r\n        eventName = \"error\";\r\n      } else if (this[sTimedOut]) {\r\n        eventName = \"timeout\";\r\n      }\r\n      this[sDispatch](new CustomEvent(eventName));\r\n    }).finally(() => this[sDispatch](new CustomEvent(\"loadend\")));\r\n  }\r\n}\r\n\r\n"],"mappings":"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","ignoreList":[]}